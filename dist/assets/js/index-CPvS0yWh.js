!function(){const e=document.createElement("link").relList;if(!(e&&e.supports&&e.supports("modulepreload"))){for(const e of document.querySelectorAll('link[rel="modulepreload"]'))t(e);new MutationObserver(e=>{for(const r of e)if("childList"===r.type)for(const e of r.addedNodes)"LINK"===e.tagName&&"modulepreload"===e.rel&&t(e)}).observe(document,{childList:!0,subtree:!0})}function t(e){if(e.ep)return;e.ep=!0;const t=function(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),"use-credentials"===e.crossOrigin?t.credentials="include":"anonymous"===e.crossOrigin?t.credentials="omit":t.credentials="same-origin",t}(e);fetch(e.href,t)}}();const e={MAX_FILE_SIZE:10485760,MAX_FILES:20,SUPPORTED_FORMATS:["image/jpeg","image/jpg","image/png","image/webp","image/gif","image/bmp","image/tiff"],DEFAULT_QUALITY:.9,MAX_WIDTH_HEIGHT:1920,MAX_SIZE_MB:1,RATE_LIMIT_DELAY:1e3,MAX_FILE_NAME_LENGTH:255,ALLOWED_FILE_EXTENSIONS:[".jpg",".jpeg",".png",".webp",".gif",".bmp",".tiff",".tif"],SECURITY_TIMEOUT:3e4,MAX_PREVIEW_SIZE:1048576,MAGIC_BYTES:{"image/jpeg":[255,216,255],"image/png":[137,80,78,71],"image/webp":[82,73,70,70],"image/gif":[71,73,70],"image/bmp":[66,77],"image/tiff":[73,73,42,0]}},t={currentFiles:[],isConverting:{value:!1},currentFormatConfig:null,lastConversionTime:{value:0},securityToken:{value:null},workerManager:null,CONFIG:e},r={},n=function(e,t,n){let o=Promise.resolve();if(t&&t.length>0){document.getElementsByTagName("link");const e=document.querySelector("meta[property=csp-nonce]"),n=(null==e?void 0:e.nonce)||(null==e?void 0:e.getAttribute("nonce"));o=Promise.allSettled(t.map(e=>{if((e=function(e){return"/image-converter/"+e}(e))in r)return;r[e]=!0;const t=e.endsWith(".css"),o=t?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${e}"]${o}`))return;const a=document.createElement("link");return a.rel=t?"stylesheet":"modulepreload",t||(a.as="script"),a.crossOrigin="",a.href=e,n&&a.setAttribute("nonce",n),document.head.appendChild(a),t?new Promise((t,r)=>{a.addEventListener("load",t),a.addEventListener("error",()=>r(new Error(`Unable to preload CSS for ${e}`)))}):void 0}))}function a(e){const t=new Event("vite:preloadError",{cancelable:!0});if(t.payload=e,window.dispatchEvent(t),!t.defaultPrevented)throw e}return o.then(t=>{for(const e of t||[])"rejected"===e.status&&a(e.reason);return e().catch(a)})},o={"image/jpeg":{name:"JPEG",extension:"jpg",quality:{min:10,max:100,default:90},options:{quality:{label:"Calidad",min:10,max:100,default:90},progressive:{label:"Progresivo",default:!0},optimizeCoding:{label:"Optimizar codificación",default:!0}}},"image/png":{name:"PNG",extension:"png",options:{compressionLevel:{label:"Nivel de compresión",min:0,max:9,default:6},interlaced:{label:"Entrelazado",default:!1}}},"image/webp":{name:"WebP",extension:"webp",quality:{min:10,max:100,default:85},options:{quality:{label:"Calidad",min:10,max:100,default:85},lossless:{label:"Sin pérdida",default:!1},nearLossless:{label:"Casi sin pérdida",default:!1}}},"image/gif":{name:"GIF",extension:"gif",options:{dither:{label:"Dithering",default:!0},colors:{label:"Número de colores",min:2,max:256,default:256}}},"image/bmp":{name:"BMP",extension:"bmp",options:{bitDepth:{label:"Profundidad de bits",options:[8,16,24,32],default:24}}},"image/ico":{name:"ICO",extension:"ico",options:{sizes:{label:"Tamaños de icono",options:[16,32,48,64,128,256],default:[16,32,48,64,128],multiple:!0,type:"checkbox"}},hiddenSizes:[8]},"image/avif":{name:"AVIF",extension:"avif",quality:{min:10,max:100,default:80},options:{quality:{label:"Calidad",min:10,max:100,default:80},speed:{label:"Velocidad de codificación",min:0,max:10,default:6},chromaSubsampling:{label:"Submuestreo de croma",options:["4:4:4","4:2:2","4:2:0"],default:"4:2:0"}}},"image/tiff":{name:"TIFF",extension:"tiff",quality:{min:10,max:100,default:90},options:{quality:{label:"Calidad",min:10,max:100,default:90},compression:{label:"Compresión",options:["none","lzw","deflate"],default:"lzw"},bitDepth:{label:"Profundidad de bits",options:[8,16,24,32],default:24}}}},a={progressive:"Mejora la carga progresiva de la imagen, permitiendo una visualización gradual durante la descarga",optimizeCoding:"Optimiza la codificación Huffman para lograr mejor compresión sin pérdida de calidad",Progresivo:"Mejora la carga progresiva de la imagen, permitiendo una visualización gradual durante la descarga","Optimizar codificación":"Optimiza la codificación Huffman para lograr mejor compresión sin pérdida de calidad",compressionLevel:"Nivel de compresión PNG (0-9). Mayor valor = más compresión pero proceso más lento",interlaced:"Carga la imagen de forma entrelazada, mostrando una versión de baja resolución primero",lossless:"Compresión sin pérdida de calidad. Mantiene todos los detalles originales",nearLossless:"Compresión casi sin pérdida. Calidad muy alta con compresión moderada",dither:"Aplica dithering para mejorar la calidad visual en imágenes con paleta limitada",colors:"Número de colores en la paleta. Menos colores = archivo más pequeño",bitDepth:"Profundidad de bits por píxel. Mayor profundidad = más colores disponibles",sizes:"Tamaños de icono para generar. Múltiples tamaños se incluyen en un archivo ZIP",speed:"Velocidad de codificación (0-10). Menor valor = más lento pero mejor calidad",chromaSubsampling:"Método de submuestreo de color. 4:4:4 = mejor calidad, 4:2:0 = mejor compresión",compression:"Tipo de compresión TIFF. LZW = buena compresión, Deflate = mejor compresión"},i={objectUrls:new Set,stats:{created:0,revoked:0,leaked:0},createObjectURL(e){const t=URL.createObjectURL(e);return this.objectUrls.add(t),this.stats.created++,t},revokeObjectURL(e){this.objectUrls.has(e)&&(URL.revokeObjectURL(e),this.objectUrls.delete(e),this.stats.revoked++)},cleanup(){this.objectUrls.forEach(e=>URL.revokeObjectURL(e)),this.stats.leaked=this.objectUrls.size,this.objectUrls.clear()},getStats(){return{...this.stats,active:this.objectUrls.size}}},s={pool:new Map,maxSize:10,stats:{created:0,reused:0,discarded:0},getCanvas(e,t){const r=`${e}x${t}`;let n=this.pool.get(r);return n?(this.pool.delete(r),this.stats.reused++,n):(n=document.createElement("canvas"),n.width=e,n.height=t,this.stats.created++,n)},returnCanvas(e){const t=`${e.width}x${e.height}`;if(this.pool.size<this.maxSize){e.getContext("2d").clearRect(0,0,e.width,e.height),this.pool.set(t,e)}else this.stats.discarded++},cleanup(){this.pool.clear()},getStats(){return{...this.stats,poolSize:this.pool.size}}},l={formatFileSize(e){if(0===e)return"0 Bytes";const t=Math.floor(Math.log(e)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]},async isValidImageType(t){if(!e.SUPPORTED_FORMATS.includes(t.type))return!1;const r=t.name.toLowerCase();if(!e.ALLOWED_FILE_EXTENSIONS.some(e=>r.endsWith(e)))return!1;const n=e.MAGIC_BYTES[t.type];return!n||await this.isValidMagicBytes(t,n)},isValidMagicBytes:async(e,t)=>new Promise(r=>{const n=new FileReader;n.onload=e=>{try{const n=e.target.result,o=new Uint8Array(n).slice(0,t.length),a=t.every((e,t)=>o[t]===e);r(a)}catch(n){r(!1)}},n.onerror=()=>r(!1),n.readAsArrayBuffer(e.slice(0,Math.max(...t.map((e,t)=>t+1))))}),isValidFileSize:t=>t.size>0&&t.size<=e.MAX_FILE_SIZE,isValidFileName(t){if(!t||"string"!=typeof t)return!1;if(t.length>e.MAX_FILE_NAME_LENGTH)return!1;if(/[<>:"/\\|?*\u0000-\u001f]/.test(t))return!1;return!/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(\.|$)/i.test(t)},sanitizeFileName(t){if(!this.isValidFileName(t))return"archivo_seguro_"+Date.now();let r=t.replace(/[^a-zA-Z0-9.-]/g,"_");if(r.length>e.MAX_FILE_NAME_LENGTH){const t=r.lastIndexOf(".");if(t>0){const n=r.substring(t),o=r.substring(0,t);r=o.substring(0,e.MAX_FILE_NAME_LENGTH-n.length)+n}else r=r.substring(0,e.MAX_FILE_NAME_LENGTH)}return r.replace(/[_\.]/g,"")||(r="archivo_seguro_"+Date.now()),r},truncateFileName(e,t=30){if(e.length<=t)return e;const r=e.lastIndexOf(".");if(-1===r)return e.substring(0,t-3)+"...";const n=e.substring(0,r),o=e.substring(r),a=t-o.length-3;if(a<=0)return"..."+o;return n.substring(0,a)+"..."+o},getFormatExtension(e){var t;return(null==(t=o[e])?void 0:t.extension)||"jpg"},validateInputParams(e){const t=[];if(e.sizes&&Array.isArray(e.sizes)){const r=[16,32,48,64,128,256];e.sizes.forEach(e=>{r.includes(parseInt(e))||t.push(`Tamaño de icono inválido: ${e}`)})}return t},checkRateLimit(t){const r=Date.now();return!(r-t.value<e.RATE_LIMIT_DELAY)&&(t.value=r,!0)},generateSecurityToken(e){const t=new Uint8Array(32);return crypto.getRandomValues(t),e.value=Array.from(t,e=>e.toString(16).padStart(2,"0")).join(""),e.value},validateSecurityToken:(e,t)=>e===t.value,sanitizeText:e=>"string"!=typeof e?"":"undefined"!=typeof DOMPurify?DOMPurify.sanitize(e,{ALLOWED_TAGS:[],ALLOWED_ATTR:[]}):e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),toggleDarkMode(e){const t=document.documentElement.classList.toggle("dark");localStorage.setItem("darkMode",t?"true":"false"),this.updateDarkModeIcons(t,e)},updateDarkModeIcons(e,t){e?(t.moonIcon.classList.add("hidden"),t.sunIcon.classList.remove("hidden")):(t.moonIcon.classList.remove("hidden"),t.sunIcon.classList.add("hidden"))},initDarkMode(e){const t=localStorage.getItem("darkMode"),r=window.matchMedia("(prefers-color-scheme: dark)").matches;let n=!1;("true"===t||null===t&&r)&&(n=!0),n?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),this.updateDarkModeIcons(n,e)},showError(e,t){const r=this.sanitizeText(e);t.errorText.textContent=r,t.errorMessage.classList.remove("hidden"),setTimeout(()=>{t.errorMessage.classList.add("hidden")},5e3)},hideError(e){e.errorMessage.classList.add("hidden")},showLoading(e,t){e.loading.classList.remove("hidden"),e.convertButton.disabled=!0,t.value=!0},hideLoading(e,t){e.loading.classList.add("hidden"),e.convertButton.disabled=!1,t.value=!1},downloadFile(e,t){const r=i.createObjectURL(e),n=document.createElement("a");n.href=r,n.download=t,n.style.display="none",document.body.appendChild(n),n.click(),document.body.removeChild(n),setTimeout(()=>{i.revokeObjectURL(r)},1e3)},async createZipFile(e){const t=new((await n(()=>import("./utils-DLf3yo0Z.js").then(e=>e.j),[])).default);return e.forEach(({file:e,fileName:r})=>{t.file(r,e)}),await t.generateAsync({type:"blob"})},createOptionElement(e,t,r){const n=document.createElement("div");n.className="format-option";const o=document.createElement("label");o.className="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2 flex items-center";const i=t in a?t:r.label;if(a[i]?o.innerHTML=`\n        ${this.sanitizeText(r.label)}\n        <svg class="w-4 h-4 ml-1 text-gray-400 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n        </svg>\n        <span class="tooltip-text">${this.sanitizeText(a[i])}</span>\n      `:o.textContent=r.label,"checkbox"===r.type&&r.options){const e=document.createElement("div");e.className="space-y-2",r.options.forEach(n=>{const o=document.createElement("div");o.className="flex items-center";const a=document.createElement("input");a.type="checkbox",a.id=`checkbox-${t}-${n}`,a.value=n,a.name=t,a.className="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-500 dark:bg-gray-600 rounded",r.default&&r.default.includes(n)&&(a.checked=!0);const i=document.createElement("label");i.htmlFor=`checkbox-${t}-${n}`,i.className="text-sm text-gray-700 dark:text-gray-300",i.textContent=`${n}x${n}`,o.appendChild(a),o.appendChild(i),e.appendChild(o)}),n.appendChild(o),n.appendChild(e)}else if(r.options){const e=document.createElement("select");e.className="w-full p-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-colors bg-white dark:bg-gray-700 text-gray-900 dark:text-white",e.multiple=r.multiple||!1,e.name=t,r.options.forEach(t=>{const n=document.createElement("option");n.value=t,n.textContent=t,r.default&&(Array.isArray(r.default)?r.default.includes(t):r.default===t)&&(n.selected=!0),e.appendChild(n)}),n.appendChild(o),n.appendChild(e)}else if(void 0!==r.min&&void 0!==r.max){const e=document.createElement("input");e.type="range",e.min=r.min,e.max=r.max,e.value=r.default,e.className="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer slider",e.name=t;const a=document.createElement("span");a.className="text-sm text-gray-500 dark:text-gray-400 ml-2",a.textContent=r.default,e.addEventListener("input",e=>{a.textContent=e.target.value});const i=document.createElement("div");i.className="flex items-center",i.appendChild(e),i.appendChild(a),n.appendChild(o),n.appendChild(i)}else{const e=document.createElement("input");e.type="checkbox",e.checked=r.default,e.className="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-500 dark:bg-gray-600 rounded",e.name=t;const o=document.createElement("div");o.className="flex items-center";const i=t in a?t:r.label;a[i]?o.innerHTML=`\n          <input type="checkbox" ${r.default?"checked":""} class="mr-2 h-4 w-4 text-blue-600 focus:ring-blue-500 border-gray-300 dark:border-gray-500 dark:bg-gray-600 rounded" name="${this.sanitizeText(t)}">\n          <span class="flex items-center text-gray-700 dark:text-gray-300">\n            ${this.sanitizeText(r.label)}\n            <svg class="w-4 h-4 ml-1 text-gray-400 dark:text-gray-500 cursor-help" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.228 9c.549-1.165 2.03-2 3.772-2 2.21 0 4 1.343 4 3 0 1.4-1.278 2.575-3.006 2.907-.542.104-.994.54-.994 1.093m0 3h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>\n            </svg>\n            <span class="tooltip-text">${this.sanitizeText(a[i])}</span>\n          </span>\n        `:(o.appendChild(e),o.appendChild(document.createTextNode(r.label))),n.appendChild(o)}return n},createIcoFile:async e=>new Promise(t=>{e.toBlob(e=>{t(e)},"image/png")}),resizeImage:async(e,t,r)=>new Promise((n,o)=>{const a=s.getCanvas(t,r),l=a.getContext("2d"),d=new Image;d.onload=()=>{try{l.imageSmoothingEnabled=!0,l.imageSmoothingQuality="high",l.drawImage(d,0,0,t,r),a.toBlob(e=>{e?n(e):o(new Error("Error al crear blob")),s.returnCanvas(a)},"image/png",1)}catch(e){s.returnCanvas(a),o(e)}},d.onerror=()=>{s.returnCanvas(a),o(new Error("Error al cargar imagen"))},d.src=i.createObjectURL(e)})},d={conversions:{total:0,successful:0,failed:0},files:{processed:0,totalSize:0},timing:{startTime:null,lastConversion:null},memory:{peakUsage:0,currentUsage:0},startConversion(){this.timing.startTime=performance.now(),this.conversions.total++},endConversion(e=!0){e?this.conversions.successful++:this.conversions.failed++,this.timing.lastConversion=performance.now()},addFile(e){this.files.processed++,this.files.totalSize+=e.size},updateMemoryUsage(){performance.memory&&(this.memory.currentUsage=performance.memory.usedJSHeapSize,this.memory.peakUsage=Math.max(this.memory.peakUsage,this.memory.currentUsage))},getStats(){return{conversions:{...this.conversions},files:{...this.files},timing:{...this.timing},memory:{...this.memory},canvasPool:s.getStats(),memoryManager:i.getStats()}},logStats(){this.getStats()}};let c=null,m=null,u=null,g=null;const p={async loadImageCompression(){if(!c){const e=await n(()=>import("./vendor-Dzd0jNqw.js"),[]);c=e.default}return c},async loadWorkerManager(){if(!m){const e=await n(()=>import("./worker-manager-B8fHqTIN.js"),[]);m=e.default}return m},async loadToastImageEditor(){if(!u){if("undefined"==typeof tui||!tui.ImageEditor)throw new Error("TOAST UI Image Editor no está disponible");u=tui.ImageEditor}return u},async loadFabric(){if(!g){const e=await n(()=>import("./index.min-DGKulfNo.js"),[]);g=e.fabric}return g}},h={async handleFileSelect(e,t,r){const n=Array.from(e.target.files);n.length>0&&await this.processFiles(n,t,r)},async handleDrop(e,t,r){e.preventDefault(),r.dropZone.classList.remove("border-blue-400","bg-blue-50");const n=Array.from(e.dataTransfer.files);n.length>0&&await this.processFiles(n,t,r)},handleDragOver(e,t){e.preventDefault(),t.dropZone.classList.add("border-blue-400","bg-blue-50")},handleDragLeave(e,t){e.preventDefault(),t.dropZone.classList.remove("border-blue-400","bg-blue-50")},async processFiles(e,t,r){try{if(!Array.isArray(e)||0===e.length)return void l.showError("No se proporcionaron archivos válidos",r);if(e.length>t.CONFIG.MAX_FILES)return void l.showError(`Máximo ${t.CONFIG.MAX_FILES} archivos permitidos`,r);const n=[],o=[],a=e.map(async e=>{try{if(!(e&&e instanceof File))return{valid:!1,error:"Archivo inválido"};if(!l.isValidFileName(e.name))return{valid:!1,error:`Nombre inválido: ${e.name}`};return await l.isValidImageType(e)?l.isValidFileSize(e)?0===e.size?{valid:!1,error:`Archivo vacío: ${e.name}`}:(d.addFile(e),{valid:!0,file:e}):{valid:!1,error:`Tamaño excede límite: ${e.name}`}:{valid:!1,error:`Tipo no soportado: ${e.name}`}}catch(t){return{valid:!1,error:`Error en archivo: ${e.name}`}}});(await Promise.all(a)).forEach(e=>{e.valid?n.push(e.file):o.push(e.error)}),o.length>0&&l.showError(`Archivos inválidos: ${o.slice(0,3).join(", ")}${o.length>3?"...":""}`,r),n.length>0&&(t.currentFiles=n,l.hideError(r),this.updateFileList(t,r))}catch(n){l.showError("Error procesando archivos",r)}},updateFileList(e,t){t.fileList&&t.fileListContainer&&(t.fileList.innerHTML="",0!==e.currentFiles.length?(t.fileListContainer.classList.remove("hidden"),e.currentFiles.forEach((r,n)=>{const o=document.createElement("div");o.className="file-list-item";const a=document.createElement("div");a.className="flex items-center flex-1";const s=document.createElement("div");s.className="file-preview-thumbnail";const d=document.createElement("img");d.className="w-full h-full object-cover",d.alt=`Vista previa de ${r.name}`;const c=i.createObjectURL(r);r.previewUrl=c,d.src=c,s.appendChild(d);const m=document.createElement("div");m.className="file-info";const u=l.truncateFileName(r.name,25),g=l.sanitizeText(r.name),p=l.sanitizeText(u),h=l.sanitizeText(l.formatFileSize(r.size));m.innerHTML=`\n        <div class="file-name" title="${g}">${p}</div>\n        <div class="file-size">${h}</div>\n      `,a.appendChild(s),a.appendChild(m);const f=document.createElement("div");f.className="flex items-center space-x-2";const v=document.createElement("button");v.className="edit-file-btn",v.innerHTML='\n        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>\n        </svg>\n      ',v.title="Editar imagen",v.onclick=()=>{this.openImageEditor&&this.openImageEditor(n,e,t)};const E=document.createElement("button");E.className="remove-file-btn",E.innerHTML='\n        <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n        </svg>\n      ',E.onclick=()=>{this.removeFile(n,e,t)},f.appendChild(v),f.appendChild(E),o.appendChild(a),o.appendChild(f),t.fileList.appendChild(o)})):t.fileListContainer.classList.add("hidden"))},removeFile(e,t,r){const n=t.currentFiles[e];n&&n.previewUrl&&i.revokeObjectURL(n.previewUrl),t.currentFiles.splice(e,1),this.updateFileList(t,r),this.updateFileInfo(t,r)},updateFileInfo(e,t){},removeAllImages(e,t){e.currentFiles.forEach(e=>{e.previewUrl&&i.revokeObjectURL(e.previewUrl)}),e.currentFiles=[],t.fileInput.value="",t.fileListContainer.classList.add("hidden"),this.updateFileList(e,t),l.hideError(t)},updateFormatOptions(e,t){const r=t.formatSelect.value;e.currentFormatConfig=o[r],e.currentFormatConfig&&(t.formatOptions.innerHTML="",Object.entries(e.currentFormatConfig.options).forEach(([r,n])=>{const o=l.createOptionElement(e.currentFormatConfig,r,n);t.formatOptions.appendChild(o)}))},getFormatOptions(e){const t={};return e.formatOptions.querySelectorAll("input, select").forEach(e=>{"checkbox"===e.type?(e.name in t||(t[e.name]=[]),e.checked&&t[e.name].push(e.value)):"range"===e.type?t[e.name]=parseInt(e.value):"SELECT"===e.tagName&&(e.multiple?t[e.name]=Array.from(e.selectedOptions).map(e=>e.value):t[e.name]=e.value)}),t},async convertImage(e,t){try{if(d.startConversion(),d.updateMemoryUsage(),0===e.currentFiles.length)return l.showError("No hay archivos seleccionados",t),void d.endConversion(!1);if(e.isConverting.value)return l.showError("Conversión en progreso",t),void d.endConversion(!1);if(!e.currentFormatConfig)return l.showError("Formato no configurado",t),void d.endConversion(!1);if(!l.checkRateLimit(e.lastConversionTime))return l.showError("Espere un momento antes de realizar otra conversión",t),void d.endConversion(!1);const n=t.formatSelect.value,o=this.getFormatOptions(t),a=l.validateInputParams(o);if(a.length>0)return void l.showError(`Parámetros inválidos: ${a.join(", ")}`,t);const i=new Promise((t,r)=>{setTimeout(()=>r(new Error("Timeout de seguridad")),e.CONFIG.SECURITY_TIMEOUT)});l.showLoading(t,e.isConverting),l.hideError(t),l.generateSecurityToken(e.securityToken);try{const r=this.performConversion(n,o,e,t);await Promise.race([r,i])}catch(r){"Timeout de seguridad"===r.message?l.showError("Operación cancelada por seguridad",t):l.showError("Error durante la conversión",t),d.endConversion(!1)}finally{l.hideLoading(t,e.isConverting),d.updateMemoryUsage()}}catch(r){l.showError("Error interno del sistema",t),d.endConversion(!1),l.hideLoading(t,e.isConverting)}},async performConversion(e,t,r,n){"image/ico"===e&&t.sizes?await this.convertToIcoMultiple(t.sizes,r,n):r.workerManager&&r.workerManager.isWorkerAvailable()?await this.performConversionWithWorker(e,t,r,n):await this.performConversionSync(e,t,r,n)},async performConversionWithWorker(e,t,r,n){try{if(!r.workerManager){const e=await p.loadWorkerManager();if(!e.isSupported())throw new Error("Web Workers no soportados");r.workerManager=new e}const a=o[e].quality.default/100,i={maxSizeMB:r.CONFIG.MAX_SIZE_MB,maxWidthOrHeight:r.CONFIG.MAX_WIDTH_HEIGHT,fileType:e,quality:a,...t},s=await r.workerManager.processMultipleFiles(r.currentFiles,i,e=>{}),d=[];for(let t=0;t<s.length;t++){const n=s[t];if(!n.success)throw new Error(`Error convirtiendo archivo ${t+1}: ${n.error}`);{const o=r.currentFiles[t].name.split(".")[0],a=l.getFormatExtension(e),i=l.sanitizeFileName(`${o}_converted.${a}`);d.push({file:n.file,fileName:i})}}if(1===d.length)l.downloadFile(d[0].file,d[0].fileName),this.showSuccessMessage(r,d[0].file.size,n);else{const e=await l.createZipFile(d),t=`imagenes_convertidas_${(new Date).toISOString().slice(0,10)}.zip`;l.downloadFile(e,t),this.showSuccessMessage(r,0,n,`Convertidos ${d.length} archivos en ZIP`)}}catch(a){await this.performConversionSync(e,t,r,n)}},async performConversionSync(e,t,r,n){const a=await p.loadImageCompression(),i=[];for(let d=0;d<r.currentFiles.length;d++)try{const n=r.currentFiles[d],s=o[e].quality.default/100,c={maxSizeMB:r.CONFIG.MAX_SIZE_MB,maxWidthOrHeight:r.CONFIG.MAX_WIDTH_HEIGHT,useWebWorker:!1,fileType:e,quality:s,...t,onProgress:e=>{}},m=await a(n,c),u=n.name.split(".")[0],g=l.getFormatExtension(e),p=l.sanitizeFileName(`${u}_converted.${g}`);i.push({file:m,fileName:p})}catch(s){throw new Error(`Error convirtiendo archivo ${d+1}`)}if(1===i.length)l.downloadFile(i[0].file,i[0].fileName),this.showSuccessMessage(r,i[0].file.size,n);else{const e=await l.createZipFile(i),t=`imagenes_convertidas_${(new Date).toISOString().slice(0,10)}.zip`;l.downloadFile(e,t),this.showSuccessMessage(r,0,n,`Convertidos ${i.length} archivos en ZIP`)}},async convertToIcoMultiple(e,t,r){const n=[],a=[],i=o["image/ico"],s=[...i.hiddenSizes||[],...e];for(let o=0;o<t.currentFiles.length;o++){const e=t.currentFiles[o],r=e.name.split(".")[0];for(const t of s)try{const o=document.createElement("canvas"),a=o.getContext("2d"),s=new Image;await new Promise((r,n)=>{s.onload=()=>{try{o.width=t,o.height=t,a.imageSmoothingEnabled=!0,a.imageSmoothingQuality="high",a.drawImage(s,0,0,t,t),r()}catch(e){n(e)}},s.onerror=()=>n(new Error("Error al cargar imagen")),s.src=URL.createObjectURL(e)});const d=await new Promise(e=>{o.toBlob(t=>{e(t||null)},"image/png",1)});if(!d)throw new Error(`No se pudo crear blob para ${t}x${t}`);if(!i.hiddenSizes.includes(t)){const e=l.sanitizeFileName(`${r}_${t}x${t}.ico`);n.push({file:d,fileName:e})}}catch(d){const r=`Error convirtiendo ${e.name} a ${t}x${t}: ${d.message}`;a.push(r)}}if(a.length,0!==n.length)if(1===n.length)l.downloadFile(n[0].file,n[0].fileName),this.showSuccessMessage(t,0,r,"Icono convertido exitosamente");else{const e=await l.createZipFile(n),o=`iconos_${(new Date).toISOString().slice(0,10)}.zip`;l.downloadFile(e,o),this.showSuccessMessage(t,0,r,`Generados ${n.length} iconos en ZIP`)}else l.showError("No se pudo generar ningún icono. Verifica que las imágenes sean válidas.",r)},showSuccessMessage(e,t,r,n=null){let o=n;if(!o){const r=e.currentFiles.reduce((e,t)=>e+t.size,0);o=`Conversión exitosa - Reducción: ${r>0?((r-t)/r*100).toFixed(1):0}%`}const a=document.createElement("div");a.className="fixed top-4 right-4 bg-green-500 text-white p-4 rounded-lg shadow-lg z-50 notification-enter",a.innerHTML=`\n      <div class="flex items-center">\n        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>\n        </svg>\n        <span>${o}</span>\n      </div>\n    `,document.body.appendChild(a),setTimeout(()=>{a.classList.add("notification-exit"),setTimeout(()=>{document.body.contains(a)&&document.body.removeChild(a)},300)},3e3)},async openImageEditor(e,t,r){const n=t.currentFiles[e];if(!n)return;if("undefined"==typeof tui||void 0===tui.ImageEditor)return void l.showError("Editor de imagen no disponible. Por favor, recarga la página.",r);const o=document.createElement("div");o.className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50",o.id="imageEditorModal";const a=i.createObjectURL(n);o.innerHTML='\n      <div class="bg-white dark:bg-gray-800 rounded-xl shadow-2xl max-w-7xl w-full mx-4 max-h-[95vh] overflow-hidden">\n        <div class="flex items-center justify-between p-4 border-b border-gray-200 dark:border-gray-700">\n          <h3 class="text-lg font-semibold text-gray-900 dark:text-white">Editor de Imagen</h3>\n          <div class="flex items-center space-x-2">\n            <button id="saveAndCloseBtn" class="text-green-600 hover:text-green-700 dark:text-green-400 dark:hover:text-green-300 p-2 rounded-lg hover:bg-green-50 dark:hover:bg-green-900/20 transition-colors" title="Guardar cambios y cerrar editor">\n              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"></path>\n              </svg>\n            </button>\n            <button id="closeEditor" class="text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 p-2 rounded-lg hover:bg-gray-100 dark:hover:bg-gray-700 transition-colors">\n              <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">\n                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>\n              </svg>\n            </button>\n          </div>\n        </div>\n        <div class="relative flex-1" style="height: calc(95vh - 80px);">\n          <div id="tui-image-editor-container" class="w-full h-full bg-gray-50 dark:bg-gray-900"></div>\n        </div>\n      </div>\n    ',document.body.appendChild(o),await this.initToastImageEditor(e,a,t,r)},async initToastImageEditor(e,t,r,n){const o=await p.loadToastImageEditor(),a=document.getElementById("tui-image-editor-container");if(!a)return;document.documentElement.classList.contains("dark");const i={includeUI:{loadImage:{path:t,name:"image"},locale:{Crop:"Recortar","Delete-all":"Eliminar todo",Flip:"Voltear",Rotate:"Rotar",Draw:"Dibujar",Shape:"Forma",Icon:"Icono",Text:"Texto",Mask:"Máscara",Filter:"Filtro",Zoom:"Zoom",Undo:"Deshacer",Redo:"Rehacer",Reset:"Restablecer",Save:"Guardar",Cancel:"Cancelar"},initMenu:"filter",menuBarPosition:"bottom"},cssMaxWidth:700,cssMaxHeight:500,selectionStyle:{cornerSize:20,rotatingPointOffset:70},usageStatistics:!1};try{const s=new o(a,i);this.editorState={editor:s,fileIndex:e,imageUrl:t},this.setupToastEventListeners(r,n)}catch(s){l.showError("Error al cargar el editor de imagen",n)}},setupToastEventListeners(e,t){if(document.getElementById("closeEditor").onclick=()=>this.closeImageEditor(e,t),document.getElementById("saveAndCloseBtn").onclick=()=>this.applyImageChanges(e,t),this.editorState&&this.editorState.editor){const e=this.editorState.editor;e.on("load",()=>{}),e.on("objectActivated",e=>{}),e.on("objectMoved",e=>{})}},closeImageEditor(e,t){const r=document.getElementById("imageEditorModal");r&&(this.editorState&&this.editorState.editor&&this.editorState.editor.destroy(),document.body.removeChild(r)),this.editorState&&this.editorState.imageUrl&&i.revokeObjectURL(this.editorState.imageUrl),this.editorState=null},applyImageChanges(e,t){if(!this.editorState||!this.editorState.editor)return;const{editor:r,fileIndex:n}=this.editorState,o=e.currentFiles[n];try{const a=r.toDataURL({format:"png",quality:.9});this.dataURLToBlob(a).then(r=>{const a=new File([r],o.name,{type:o.type});e.currentFiles[n]=a,o.previewUrl&&i.revokeObjectURL(o.previewUrl),this.closeImageEditor(e,t),this.updateFileList(e,t),this.showSuccessMessage(e,0,t,"Imagen editada exitosamente")}).catch(e=>{l.showError("Error al procesar la imagen editada",t)})}catch(a){l.showError("Error al procesar la imagen editada",t)}},dataURLToBlob:e=>new Promise((t,r)=>{try{const n=e.split(",")[1];if(!n)return void r(new Error("Data URL inválida"));const o=atob(n),a=new Array(o.length);for(let e=0;e<o.length;e++)a[e]=o.charCodeAt(e);const i=new Uint8Array(a);t(new Blob([i],{type:"image/png"}))}catch(n){r(n)}}),calculateImageSize(e,t,r,n){const o=Math.min(r/e,n/t);return{width:e*o,height:t*o}}},f={},v=async()=>{f.fileInput=document.getElementById("fileInput"),f.dropZone=document.getElementById("dropZone"),f.formatSelect=document.getElementById("formatSelect"),f.convertButton=document.getElementById("convertButton"),f.errorMessage=document.getElementById("errorMessage"),f.errorText=document.getElementById("errorText"),f.loading=document.getElementById("loading"),f.formatOptions=document.getElementById("formatOptions"),f.fileList=document.getElementById("fileList"),f.fileListContainer=document.getElementById("fileListContainer"),f.darkModeToggle=document.getElementById("darkModeToggle"),f.moonIcon=document.getElementById("moonIcon"),f.sunIcon=document.getElementById("sunIcon"),l.initDarkMode(f),f.fileInput.addEventListener("change",e=>h.handleFileSelect(e,t,f)),f.dropZone.addEventListener("click",()=>f.fileInput.click()),f.dropZone.addEventListener("drop",e=>h.handleDrop(e,t,f)),f.dropZone.addEventListener("dragover",e=>h.handleDragOver(e,f)),f.dropZone.addEventListener("dragleave",e=>h.handleDragLeave(e,f)),f.convertButton.addEventListener("click",()=>h.convertImage(t,f)),f.formatSelect.addEventListener("change",()=>h.updateFormatOptions(t,f)),f.darkModeToggle.addEventListener("click",()=>l.toggleDarkMode(f)),h.updateFormatOptions(t,f),f.dropZone.addEventListener("dragover",e=>e.preventDefault()),f.dropZone.addEventListener("drop",e=>e.preventDefault()),window.addEventListener("beforeunload",()=>{t.workerManager&&t.workerManager.terminate()}),window.addEventListener("error",e=>{l.showError("Error interno del sistema",f)}),window.addEventListener("unhandledrejection",e=>{l.showError("Error en operación asíncrona",f)})};"loading"===document.readyState?document.addEventListener("DOMContentLoaded",v):v();
